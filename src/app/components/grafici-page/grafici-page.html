<div class="grafici-container">

    <!-- HEADER -->
    <div class="page-header">
        <h1>ğŸ“Š Analisi Finanziaria</h1>
        <p class="subtitle">Visualizza le tue spese per categoria con filtri personalizzabili</p>
    </div>

    <!-- FILTRI -->
    <div class="filtri-section">
        <h2>Filtri Periodo</h2>

        <!-- Pulsanti rapidi -->
        <div class="quick-filters">
            <button class="btn-quick" (click)="impostaPeriodo('ultimi7')">
                ğŸ“… Ultimi 7 giorni
            </button>
            <button class="btn-quick" (click)="impostaPeriodo('ultimi30')">
                ğŸ“… Ultimi 30 giorni
            </button>
            <button class="btn-quick" (click)="impostaPeriodo('questoMese')">
                ğŸ“… Questo mese
            </button>
            <button class="btn-quick" (click)="impostaPeriodo('questoAnno')">
                ğŸ“… Quest'anno
            </button>
        </div>

        <!-- Filtri personalizzati -->
        <div class="custom-filters">
            <div class="form-group">
                <label for="data-inizio">Data Inizio</label>
                <input type="date" id="data-inizio" [(ngModel)]="filtri.data_inizio" class="form-control" />
            </div>

            <div class="form-group">
                <label for="data-fine">Data Fine</label>
                <input type="date" id="data-fine" [(ngModel)]="filtri.data_fine" class="form-control" />
            </div>

            <div class="form-group">
                <label for="conto">Conto</label>
                <select id="conto" [(ngModel)]="filtri.conto_id" class="form-control">
                    <option [value]="null">Tutti i conti</option>
                    @for (conto of conti; track conto.id) {
                        <option [ngValue]="conto.id">{{ conto.nome }}</option>
                    }
                </select>
            </div>

            <div class="form-actions">
                <button class="btn-primary" (click)="applicaFiltri()">
                    ğŸ” Applica Filtri
                </button>
                <button class="btn-secondary" (click)="resetFiltri()">
                    ğŸ”„ Reset
                </button>
            </div>
        </div>
    </div>

    <!-- LOADING STATE -->
    @if (loading) {
    <div class="loading-section">
        <div class="spinner"></div>
        <p>Caricamento grafici in corso...</p>
    </div>
    }

    <!-- ERROR STATE -->
    @if (error && !loading) {
    <div class="error-section">
        <p>âŒ {{ error }}</p>
        <button class="btn-secondary" (click)="loadSpesePerTag()">
            ğŸ”„ Riprova
        </button>
    </div>
    }

    <!-- GRAFICI -->
    @if (!loading && !error) {

    <!-- Info Periodo -->
    <div class="info-section">
        <div class="info-card">
            <span class="info-label">Periodo:</span>
            <span class="info-value">{{ periodoVisualizzato }}</span>
        </div>
        <div class="info-card">
            <span class="info-label">Totale Spese:</span>
            <span class="info-value totale">â‚¬{{ totaleGenerale | number:'1.2-2' }}</span>
        </div>
    </div>

    <!-- Grid Grafici -->
    <div class="charts-grid">

        <!-- Grafico Spese per Tag -->
        <div class="chart-card">
            <div echarts [options]="pieChartOption" [autoResize]="true" class="chart-container">
            </div>
        </div>

        <!-- Placeholder grafici futuri -->
        <div class="chart-card placeholder">
            <div class="placeholder-content">
                <span class="placeholder-icon">ğŸ“Š</span>
                <p class="placeholder-title">Guadagni vs Spese</p>
                <small class="placeholder-subtitle">Prossimamente</small>
            </div>
        </div>

        <div class="chart-card placeholder">
            <div class="placeholder-content">
                <span class="placeholder-icon">ğŸ“ˆ</span>
                <p class="placeholder-title">Andamento Saldo</p>
                <small class="placeholder-subtitle">Prossimamente</small>
            </div>
        </div>

    </div>
    }

</div>